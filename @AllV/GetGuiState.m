function DATA = GetGuiState(DATA, F)    X = get(F,'UserData');    if ~isfield(X,'toplevel') || X.toplevel ~= F        return;    end    if X.currentcluster > 1 %&& length(DATA.cluster.next) >= X.currentcluster-1 ...             %&& ~isempty(DATA.cluster.next{X.currentcluster-1})        DATA.currentcluster = X.currentcluster;    end    guistate = DATA.guistate;    DATA.plotspk.bytrial = X.plotspk.bytrial;    DATA.plotspk.showmean = X.plotspk.showmean;    DATA.plotspk.showfullv = X.plotspk.showfullv;    DATA.plotspk.includeprepost = X.plotspk.includeprepost;    DATA.elmousept = X.elmousept;    DATA.logfid = X.logfid;%logfid allways -1 these days, since use logname        DATA.logfid = -1;    DATA.maintitle = X.maintitle;    DATA.clustericon = X.clustericon;    DATA.quickcutmode = X.quickcutmode;    DATA.comparecell = X.comparecell;    DATA.toplevel = X.toplevel;        for f = {'handles' 'loadedClusterDetails' 'DataType' 'Expt' 'probeswitchmode'...            'fullvswitchmode', 'refcut', 'guistate', 'plottype' ...            'plotexptfit' 'logname' 'auto' 'checkclusters' 'profiling' 'ptsz'...            'setspkrate' 'Comments' 'plot' 'LastClusters' 'gui' 'clplot' 'xyplot' 'quicksave' 'optimizemode' 'logname'}        if isfield(X,f{1})            DATA.(f{1}) = X.(f{1});        end    end        if guistate.UseAutoClusters > 0        DATA.guistate.UseAutoClusters = guistate.UseAutoClusters;    end    