function CalcXcorr(a,b,fcn)DATA = GetDataFromFig(a);DataClusters = AllV.mygetappdata(DATA,'Clusters');colors = mycolors;if strcmp(fcn,'clusters')    ta = DATA.t(DATA.clst ==DATA.currentcluster+1);    AllV.SetFigure(DATA.tag.xcorr, DATA,'front');    hold off;    cls = unique(DATA.clst);    subplot(1,1,1);    for j = 1:length(cls)        tb = DATA.t(DATA.clst ==cls(j));        [xc, details] = xcorrtimes(ta,tb,'times',[-0.1:0.0001:0.1]);        if cls(j) == DATA.currentcluster+1 %autocorrelation            xc(details.midpt) = 0;        end        h(j) = plot(details.xpts,xc,'color',DATA.colors{cls(j)});        labels{j} = sprintf('cl%d->cl%d',DATA.currentcluster,cls(j)-1);        hold on;    end    legend(h,labels);elseif strcmp(fcn,'probes')    p = AllV.ProbeNumber(DATA);    AllV.SetFigure(DATA.tag.xcorr, DATA,'front');    chspk = setdiff(DATA.chspk,DATA.probe(1));    ta = DATA.t(DATA.clst ==DATA.currentcluster+1);    hold off;    labels = {};    ta = DATA.t(DATA.clst ==DATA.currentcluster+1);    for j = 1:length(chspk)        tb = DataClusters{chspk(j)}.times;        [xc, details] = xcorrtimes(ta,tb,'times',-0.1:0.0001:0.1);        labels{end+1} = num2str(chspk(j));        plot(details.xpts,xc./mean(xc),'color',colors{length(labels)});        hold on;        peak = details.efficacy.*details.counts;        peak = max(xc)./mean(xc);        text(0,peak,labels{end});        for k = 1:length(DataClusters{chspk(j)}.next)            if isfield(DataClusters{chspk(j)}.next{k},'times')                tb = DataClusters{chspk(j)}.next{k}.times;                [xc, details] = xcorrtimes(ta,tb,'times',-0.1:0.0001:0.1);                labels{end+1} = sprintf('%d/%d',chspk(j),k+1);                plot(details.xpts,xc./mean(xc),'color',colors{length(labels)});                text(0,xc(details.midpt)./mean(xc),labels{end});            end        end    end    legend(labels);    title(sprintf('Crosscorr for P%d/%d',p,DATA.currentcluster));end