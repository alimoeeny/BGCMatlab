function [S, new] = CheckAllSpikes(DATA, e,p, varargin)%[S, new] = CheckAllSpikes(DATA, e,p, varargin)%If Clusters has been changed, calling this can be slow since% it calls PC.CheckClusterLoaded, so changing the app data leads to a long% delay.  use 'noload' to skip this.listtype = PC.GetValue(DATA, 'listtype');checkcl = 1;reload = 0;j = 1;while j <= length(varargin)    if strncmpi(varargin{j},'autolist',6)        listtype = 'autolist';    elseif strncmpi(varargin{j},'nocheck',6)        checkcl = 0;    elseif strncmpi(varargin{j},'reload',6)        reload = 1;    end    j = j+1;endS = getappdata(DATA.toplevel, 'AllSpikes');    sz = size(S);    new = 0;    if checkcl        PC.CheckClusterLoaded(DATA,e,listtype);    end    for j = 1:length(e)        if sum(size(e) == size(p)) == 2            if sz(1) < e(j) || sz(2) < p(j) || ~isfield(S{e(j),p(j)},'values') || reload                S =  PC.AddSpikes(DATA, S, e(j),p(j),varargin{:});                new = new+1;            end        else            for k = 1:length(p)                if sz(1) < e(j) || sz(2) < p(k) || ~isfield(S{e(j),p(k)},'values') || reload                    S =  PC.AddSpikes(DATA, S, e(j),p(k),varargin{:});                    new = new+1;                end            end        end    end    if new        setappdata(DATA.toplevel,'AllSpikes',S);    end