function [handles, details] = PlotPopPoints(X,Y, varargin)j = 1;colorscheme = 'none';shapelist = [];include = ones(size(X));holdon = 0;colorlabels = {'1' '2' '3'};filllabels = {'Not' 'Cell'};nid = find(X == 0 & Y == 0);include(nid) = 0;clid = 1;while j <= length(varargin)    if isstruct(varargin{j})        DATA = varargin{j};    elseif strncmpi(varargin{j},'exclude',6)        j = j+1;        if strcmp(varargin{j},'offpeak') %trigger chan not biggest in mean            id = find(abs(DATA.peakdiff) > 0);            include(id) = 0;        end    elseif strncmpi(varargin{j},'clid',6)        j = j+1;        clid = varargin{j};    elseif strncmpi(varargin{j},'colors',6)        j = j+1;        colorscheme = varargin{j};    elseif strncmpi(varargin{j},'colorlabels',9)        j = j+1;        colorlabels = varargin{j};    elseif strncmpi(varargin{j},'filllabels',9)        j = j+1;        filllabels = varargin{j};    elseif strncmpi(varargin{j},'hold',4)        holdon = 1;    elseif strncmpi(varargin{j},'includelist',10)        j = j+1;        include = varargin{j};    elseif strncmpi(varargin{j},'shapes',6)        j = j+1;        shapelist = varargin{j};    end    j = j+1;end    colors = mycolors;types = 1;if isnumeric(colorscheme)    types = colorscheme;    c = abs(colorscheme);    fill = 1-sign(colorscheme); %fill cellselseif strmatch(colorscheme,'probe')    colors = mycolors('ncol',24);    c = repmat([1:size(X,2)],size(X,1),1);    fill = zeros(size(c));elseif strmatch(colorscheme,'expt')    colors = mycolors('ncol',size(X,1));    c = repmat([1:size(X,1)]',1,size(X,2));    fill = zeros(size(c));elseif strmatch(colorscheme,'cutspace')    c = DATA.cutspace;    fill = zeros(size(c));else    c = ones(size(X));    fill = zeros(size(c));endtypelist = unique(types);if holdon     hold on;else    hold off;endnp = 0;for j = 1:size(X,1)    for k = 1:size(X,2)        if include(j,k)            if isempty(shapelist)                shape = 'o';            else                shape = shapelist(j,k);                htype(1) = 2;            end            htype(1) = 1;            htype(2) = c(j,k);            h = plot(X(j,k),Y(j,k),shape,'buttondownfcn',{@PC.HitPopPoint, j,k,'clid',clid},'color',colors{c(j,k)});            np = np+1;            if fill(j,k)                set(h,'markerfacecolor',colors{c(j,k)});                htype(1) = 2;            end            if c(j,k) > 1                htype(2) = c(j,k);            else                htype(2) = 1;            end            labels{htype(1),htype(2)} = [colorlabels{c(j,k)} ' ' filllabels{htype(1)}];            hlist(htype(1),htype(2)) = h;        if length(types) > 1            type = find(types(j,k) == typelist);            handles(type) = h;        else            handles(1) = h;        end        hold on;        end    endendif holdon == 0    legend(hlist(:),labels(:));enddetails.np = np;