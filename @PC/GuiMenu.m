function GuiMenu(a,b, type, varargin)%PC.GuiMenu Callbed by buttons specifying a type    DATA = GetDataFromFig(a);    DATA = SaveCallback(DATA,a);j = 1;while j <= length(varargin)    if isnumeric(varargin{j})        x = varargin{j};        if length(x) == 2            DATA.currentpoint = x;        end    end    j = j+1;end    if strcmp(type,'moveautocelllist')        DATA.CellList = DATA.autolist.CellList;        DATA.CellDetails.listtype = 'manualfromauto';        DATA.CellDetails.exptids = DATA.exptlist;        PC.PlotCellList(DATA,'showfig');        PC.SaveCellList(DATA,'backup');    elseif strcmp(type,'setmahaltype')        s = get(a,'UserData');        if strcmp(s,'Measure2')            DATA.measures{2} = deblank(GetPopStr(a));            DATA = PC.CalcDistances(DATA);            DATA = PC.PlotAllClusters(DATA,'scatter');        else            DATA.mahaltype = strmatch(GetPopStr(a),{'2D' 'ND' ''  '1D' '2Gauss'});            DATA.mahaltype = deblank(GetPopStr(a));            DATA.measures{1} = DATA.mahaltype;            DATA = PC.CalcDistances(DATA);            if isfield(DATA,'nclusters')                F = PC.SetFigure(DATA,DATA.tag.all);                PC.PlotMahalImage(DATA,'distance');            end        end    elseif strcmp(type,'setmeasure')        x = get(a,'value');        it = get(a,'UserData'); %handle to other menu        if myhandle(it)            s = cellstr(get(it,'string'));            if x ==1                set(it,'UserData','Distance')                id = find(strcmp(DATA.measures{1},s));            else                set(it,'UserData','Measure2');                id = find(strcmp(DATA.measures{2},s));            end            if ~isempty(id)                set(it,'value',id);            end        end    elseif strcmp(type,'setmahal2type')        DATA.measures{2} = deblank(GetPopStr(a));        DATA = PC.CalcDistances(DATA);        DATA = PC.PlotPopPoints(DATA.mdistance,DATA.matrixb,DATA);    elseif strcmp(type,'setmahalcrit')        DATA.mahalcrit = str2num(get(a,'string'));    elseif strcmp(type,'CallAllVPcs')        X = getappdata(gcbf,'SpikeData')        if isfield(X,'e')            PC.CallAllVPcs(DATA, X.e, X.p);        else            PC.CallAllVPcs(DATA, (DATA.currentpoint(1)),DATA.currentpoint(2));        end    elseif strcmp(type,'checkclusters')        PC.CheckClusters(DATA,'exclusions');        PC.CheckClusters(DATA,'nclusters');        PC.CheckClusters(DATA,'fitspace');        PC.CheckClusters(DATA,'fittimes');        DATA = PC.CheckClusterLineSign(DATA);    elseif strncmp(type,'QuantifyAll',9)        args = {};        if strcmp(type,'QuantifyAllParallel')            args = {args{:} 'parallel'};        end        RunAllVPcs(DATA.name,'quantifyall','savespikes',args{:});        DATA = PC.LoadAll(a,b, 'ifnew');    end    set(DATA.toplevel,'UserData',DATA);        