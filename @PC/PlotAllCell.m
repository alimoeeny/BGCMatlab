function varargout = PlotAllCell(DATA, type, varargin)    Clusters = getappdata(DATA.toplevel,'Clusters');        listtype = PC.GetValue(DATA,'listtype');    muCellList = [];   cellid = 0;   tag = [];   j = 1;   while j <= length(varargin)       if strncmpi(varargin{j},'auto',4)           listtype = 'autolist';       elseif strncmpi(varargin{j},'cell',4)           j = j+1;           cellid = varargin{j};       end       j = j+1;   end      varargout = {};   for j = 1:nargout       varargout{j} = [];   end      if cellid == 0       cellid = PC.GetValue(DATA,'currentcell');   end   muCellList = [];   if strcmp(listtype,'autolist')       Clusters = getappdata(DATA.toplevel,'AutoClusters');       if isfield(DATA.autolist,'CellList')            CellList = DATA.autolist.CellList;       elseif isappdata(DATA.toplevel,'AutoCellList')           A = getappdata(DATA.toplevel,'AutoCellList');            CellList = A.CellList;       else            CellList = DATA.autolist.CellList;       end       if isfield(DATA.autolist,'muCellList')           muCellList = DATA.autolist.muCellList;       end       cells = PC.SelectedCells(DATA.selectautoprobe, CellList);        currentcell = cells;        cellid = cells;        fprintf('Selected Cells %s\n',sprintf(' %d',cells));   else       CellList = DATA.CellList;       cells = PC.SelectedCells(DATA.selectprobe, CellList);       if isfield(DATA,'muCellList')           muCellList = DATA.muCellList;       end   end   colors = mycolors('spkcolors');   if strcmp(type,'allcellspks')       GetFigPos(DATA.toplevel); %record current window location and use this.       cells = unique(CellList);       cells = cells(cells > 0);       nex = 0;       for j = cells'           eids{j} = PC.PlotAllCell(DATA,'allspks','cell',j);           nex(j) = length(eids(j));           F = KeepFigure(DATA.tag.allspikes);           set(F,'Name',sprintf('Cell %d Spikes',j));           drawnow;       end       fprintf('%d graphs\n',sum(nex));       return;   end       ts = now;        id = find(ismember(CellList,cellid));    [eid, cid, clid] = ind2sub(size(CellList),id);    allid = id;    if ~isempty(muCellList)        id = find(ismember(muCellList,cellid));        allid = cat(1,allid,id);        [mueid, mucid, muclid] = ind2sub(size(muCellList),id);        eid = cat(1,eid, mueid);        cid = cat(1, cid, mucid);        clid = cat(1, clid, muclid);        muid = id;    else        muid = [];     end        [eid, id] = sort(eid);    allid = allid(id);    cid = cid(id);%don't load spikes files if just plotting MeanSpike        if strncmp(type,'allspks',6)        AllSpikes = PC.CheckAllSpikes(DATA, eid, cid,'allprobes',listtype);    end    clid = clid(id);    cid = 1+mod(cid-1,DATA.nprobes);    [nr,nc] = Nsubplots(length(eid));    if sum(strncmp(type,{'allspks' 'meanspike'},7))        PC.SetFigure(DATA,DATA.tag.allspikes);    else        PC.SetFigure(DATA,DATA.tag.allxy);    end    ClearPlot;    varargout{1} = eid;    varargout{2} = cells;    margs = {};    lastprobe = 0;    for j = 1:length(eid)        mysubplot(nr,nc,j);        if cid(j) == lastprobe            margs{1} = 'nolegend';        else            margs = {};        end        hold off;         if strcmp(type,'trighist')            hist(Clusters{eid(j)}{cid(j)}.trighist);        elseif strncmp(type,'allspks',7)            C = PC.GetClusterInfo(Clusters,[eid(j) cid(j) 1]);            if strcmp(type,'allspkswithmean')                h = PC.QuickSpikes(DATA, AllSpikes{eid(j),cid(j)},C,'showmean','ontop',1+clid(j),listtype);            else                h = PC.QuickSpikes(DATA, AllSpikes{eid(j),cid(j)},C,'empty','ontop',1+clid(j),listtype);            end            if clid(j) ~= 1                                np = clid(j)+1;                if size(h,1) >= np                      set(h(np,myhandle(h(np,:))),'color','r');                    set(h(2,myhandle(h(2,:))),'color',colors{np});                elseif length(h) > 1                    set(h(2,myhandle(h(2,:))),'color','k');                else                    set(h(1,:),'color','k');                end            end            if DATA.show.linecontextmenus                PC.AddLineContextMenu(DATA, h, eid(j), cid(j));            end            dstr = datestr(AllSpikes{eid(j),cid(j)}.Header.ctime);            dstr = dstr(1:6);           h = PC.AddTitle(DATA, PC.GetClusterInfo(C,clid(j)), 2,'cell',CellList(eid(j),cid(j),clid(j)));           %h = title(sprintf('E%.1fP%d 1D%.1f 2D%.1f %s',C.exptno,cid(j),C.mahal(4),C.mahal(1),dstr));        elseif strcmp(type,'meanspike')                h = PC.PlotMeanSpike(DATA, [eid(j) cid(j) clid(j)],listtype,'lineonly',margs{:});                t = title(sprintf('E%dP%dcl%d',eid(j), cid(j), clid(j)));        end        set(gca,'Xtick',[],'Ytick',[]);        h = get(gca,'title');        xl = get(gca,'xlim');        yl = get(gca,'ylim');        a = get(h,'position');        a(2) = yl(2);        a(1) = mean(xl);        set(h,'position',a,'VerticalAlignment','top');        set(gca,'ButtonDownFcn',{@PC.HitXYPlot, eid(j), cid(j), listtype});        c = get(gca,'Children');        for k = 1:length(c)            set(c(k),'ButtonDownFcn',{@PC.HitXYPlot, eid(j), cid(j),listtype});        end        lastprobe = cid(j);    end    if DATA.profiling        fprintf('took %.2f\n',mytoc(ts));        profile viewer;    end    