function [DATA, Expts]  = LoadExpts(DATA, varargin)%Load Expts for PlotClusters.  Expts{e} is exptno e, not row e    %So if there are missing expts expt numbers i,  Expts{i} will be empty%need to track other several things%expts actually used in CellList: DATA.exptlist, DATA.CellDetails.exptids %expts loaded here that are not empty  DATA.exptidsExpts = {};    if DATA.usealltrials        varargin = {varargin{:} 'usealltrials'};    end    if exist(DATA.exptname)         fprintf('Loading %s\n',DATA.exptname);        if strfind(DATA.exptname,'Expts.mat')            Expts = ReadExptDir(DATA.datadir);%            load(DATA.exptname);            Trials = [];        else            [Trials, Expts] = APlaySpkFile(DATA.exptname,'noerrs','nospikes',varargin{:});            if isfield(Trials.Comments,'Peninfo') & isfield(Trials.Comments.Peninfo,'probesep')                DATA.probesep(1+length(Expts)) = Trials.Comments.Peninfo.probesep;            end        end        Expts = expt.fix(Expts,'ed');        for j = 1:length(Expts)            Expts{j} = FillTrials(Expts{j},'ed');            ei = GetExptNumber(Expts{j});            if ei > 0                Expts{j}.Header.exptno = ei;            else                Expts{j}.Header.exptno = j;                ei = j;            end            DATA.electrodedepth(j) = mean([Expts{j}.Trials.ed]);            DATA.trialids{j} = [Expts{j}.Trials.id];            DATA.exptid(j) = ei;            if isfield(Expts{j}.Header,'DataType')                DATA.DataType = Expts{j}.Header.DataType;            end            if isfield(Expts{j}.Header,'probesep')            end            AllExpts{ei} = Expts{j};        end%DATA.exptid is a list of Expts for which cluster data exist%If two Expts correspond to teh same fulv file, will have two entries%in DATA.exptid here. But the repeats are removed in PC.LoadAll, when%its limited to files with matching ClusterTimes data%If some are missing, adn get here without loading clusters, first,%need to check against list of available data%Trialids is selected to match CellList after loading. in PC.LoadAll        if isfield(DATA.CellDetails,'exptids') %Check if there are any missing expts.            xid = setdiff(DATA.exptid,DATA.CellDetails.exptids);            if ~isempty(xid)                DATA.exptid = union(DATA.exptid,DATA.CellDetails.exptids);            end        end        if isfield(DATA,'exptwithcluster')            DATA.exptid = intersect(DATA.exptid,DATA.exptwithcluster);        end        Expts = AllExpts';        DATA.idsorted = 1;    elseif isfield(DATA,'exptid')        exptno = DATA.exptid;        for j = 1:length(exptno)            e = floor(exptno(j));            [Expts{e} , DATA] = PC.LoadExpt(DATA, e);        end        Expts = PC.SetExptTimeOffset(Expts);    end    if isfield(DATA,'DataType') && strncmp(DATA.DataType,'Grid',4)        DATA.nprobespool = 0;    end    if isempty(Expts)        cprintf('red','Cannot Find/Read Expts for %s - Has APlaySpkFile Run?\n', DATA.datadir);        return;    end    [DATA, Expts] = PC.SetExptList(DATA, Expts);    setappdata(DATA.toplevel,'Expts',Expts);    ShowExptErrs(Expts);        